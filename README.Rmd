---
title: "<img src='./inst/hex/orthogene.png' height='400'><br>" 
author: "<h4>Author: <i>Brian M. Schilder</i></h4>" 
date: "<h4>Most recent update: <i>`r format( Sys.Date(), '%b-%d-%Y')`</i></h4>"
output:
  github_document 
editor_options: 
  chunk_output_type: inline
---

<!-- badges: start -->
<!-- badger::badge_codecov() -->
<!-- copied from MungeSumstats README.Rmd -->
<!-- badger::badge_lifecycle("stable", "green") -->
<!-- badger::badge_last_commit()  -->
<!-- badger::badge_license() -->
[![](https://codecov.io/gh/neurogenomics/orthogene/branch/main/graph/badge.svg)](https://codecov.io/gh/neurogenomics/orthogene)
[![R-CMD-check](https://github.com/neurogenomics/MungeSumstats/workflows/R-full/badge.svg)](https://github.com/neurogenomics/MungeSumstats/actions)
[![](https://img.shields.io/badge/lifecycle-stable-green.svg)](https://lifecycle.r-lib.org/articles/stages.html#stable)
[![](https://img.shields.io/github/last-commit/neurogenomics/orthogene.svg)](https://github.com/neurogenomics/orthogene/commits/main)
[![License: Artistic-2.0](https://img.shields.io/badge/license-Artistic--2.0-blue.svg)](https://cran.r-project.org/web/licenses/Artistic-2.0)
<!-- badges: end --> 


## `orthogene`: Interspecies gene mapping 

`orthogene` is an R package for easy mapping of orthologous genes across hundreds of species.   
It pulls up-to-date interspecies gene ortholog mappings across 700+ organisms. 

It also provides various utility functions to map common objects 
(e.g. data.frames, gene expression matrices, lists) 
onto 1:1 gene orthologs from any other species. 

In brief, `orthogene` lets you easily: 

- [**`convert_orthologs`** between any two species](https://github.com/neurogenomics/orthogene#convert-orthologs) 
- [**`map_species`** names onto standard taxonomic ontologies](https://github.com/neurogenomics/orthogene#map-species)  
- [**`report_orthologs`** between any two species](https://github.com/neurogenomics/orthogene#report-orthologs) 
- [**`map_genes`** onto standard ontologies](https://github.com/neurogenomics/orthogene#map-genes) 
- [**`aggregate_mapped_genes`** in a matrix.](https://github.com/neurogenomics/orthogene#aggregate-mapped-genes)  
- [get **`all_genes`** from any species](https://github.com/neurogenomics/orthogene#get-all-genes) 


## [Documentation website](https://neurogenomics.github.io/orthogene/) 

# Installation

```{r, eval=FALSE}
if(!"remotes" %in% rownames(installed.packages())) install.packages("remotes")

remotes::install_github("neurogenomics/orthogene")
```

```{r setup}
library(orthogene)

data("exp_mouse")
# Setting to "homologene" for the purposes of quick demonstration.
# We generally recommend using method="gprofiler" (default).
method <- "homologene"
```

# Methods 

For most functions, `orthogene` lets users choose between two different methods, each with complementary strengths and weaknesses: `"gprofiler"` and `"homologene"` 

In general, we recommend you use `"gprofiler"` when possible, as it tends to be more comprehensive. 

It's also worth noting that for smaller gene sets, the speed difference between these methods becomes negligible. 

```{r pros_cons, echo=FALSE}
pros_cons <- data.frame(gprofiler=c("Reference organisms"="700+",
                       "Gene mappings"="More comprehensive",
                       "Updates"="Frequent", 
                       "Orthology databases"=paste("Ensembl",
                                                   "HomoloGene",
                                                   "WormBase",sep = ", "),
                       "Data location"="Remote",
                       "Internet connection"="Required",
                       "Speed"="Slower"),
                       
           homologene=c("# reference organisms"="20+", 
                        "Gene mappings"="Less comprehensive",
                        "Updates"="Less frequent",
                        "Orthology databases"="HomoloGene",
                        "Data location"="Local",
                        "Internet connection"="Not required",
                        "Speed"="Faster")
           )
knitr::kable(pros_cons)
```



# Quick examples

## Convert orthologs 

[`convert_orthologs`](https://neurogenomics.github.io/orthogene/reference/convert_orthologs.html) is very flexible with what users can supply as `gene_df`,
and can take a `data.frame`/`data.table`/`tibble`, (sparse) `matrix`, or `list`/`vector` containing genes.

Genes, transcripts, proteins, SNPs, or genomic ranges will be recognised in most formats (HGNC, Ensembl, RefSeq, UniProt, etc.) and can even be a mixture of different formats. 

All genes will be mapped to gene symbols, unless specified otherwise with the
`...` arguments (see `?orthogene::convert_orthologs` or [here](https://neurogenomics.github.io/orthogene/reference/convert_orthologs.html) for details).  

### Note on non-1:1 orthologs 

A key feature of [`convert_orthologs`](https://neurogenomics.github.io/orthogene/reference/convert_orthologs.html) is that it handles the issue of genes with many-to-many mappings across species. This can occur due to evolutionary divergence, and the function of these genes tends to be less conserved and less translatable. Users can address this using different strategies via `non121_strategy=`:  

1. `"drop_both_species"` : Drop genes that have duplicate mappings in either the input_species or output_species, (*DEFAULT*). 
2. `"drop_input_species"` : Only drop genes that have duplicate mappings in  `input_species`.  
3. `"drop_output_species"` : Only drop genes that have duplicate mappings in the `output_species`. 
4. `"keep_both_species"` : Keep all genes regardless of whether they have duplicate mappings in either species.  
5. `"keep_popular"` : Return only the most "popular" interspecies ortholog mappings. This procedure tends to yield a greater number of returned genes but at the cost of many of them not being true biological 1:1 orthologs. 
6. `"sum"`,`"mean"`,`"median"`,`"min"` or `"max"`: When `gene_df` is a matrix and `gene_output="rownames"`, these options will aggregate many-to-one gene mappings (`input_species`-to-`output_species`) after dropping any duplicate genes in the `output_species`.

```{r convert_orthologs}
gene_df <- convert_orthologs(gene_df = exp_mouse,
                             gene_input = "rownames", 
                             gene_output = "rownames", 
                             input_species = "mouse",
                             output_species = "human",
                             non121_strategy = "drop_both_species",
                             method = method) 

knitr::kable(as.matrix(head(gene_df)))
```

## Map species

[`map_species`](https://neurogenomics.github.io/orthogene/reference/map_species.html) lets you standardise species names from a wide variety of identifiers 
(e.g. common name, taxonomy ID, Latin name, partial match). 

All exposed `orthogene` functions (including [`convert_orthologs`](https://neurogenomics.github.io/orthogene/reference/convert_orthologs.html)) 
use `map_species` under the hood, so you don't have to worry about 
getting species names exactly right.   

You can check the full list of available species by simply running 
`map_species()` with no arguments, 
or checking [here](https://biit.cs.ut.ee/gprofiler/page/organism-list).

```{r map_species}
species <- map_species(species = c("human",9544,"mus musculus",
                                   "fruit fly","Celegans"), 
                       output_format = "scientific_name")
print(species)
```

## Report orthologs 

It may be helpful to know the maximum expected number of orthologous 
gene mappings from one species to another.

[`ortholog_report`](https://neurogenomics.github.io/orthogene/reference/report_orthologs.html) generates a report that tells you this information 
genome-wide. 

```{r report_orthologs} 
orth_zeb <- report_orthologs(target_species = "zebrafish",
                             reference_species = "human",
                             method_all_genes = method,
                             method_convert_orthologs = method) 
knitr::kable(head(orth_zeb$map))
knitr::kable(orth_zeb$report)
```


## Map genes 

[`map_genes`](https://neurogenomics.github.io/orthogene/reference/map_genes.html) finds matching *within-species* synonyms across a wide variety of gene naming conventions (HGNC, Ensembl, RefSeq, UniProt, etc.) and returns a table with standardised gene symbols (or whatever output format you prefer). 

```{r map_genes}
genes <-  c("Klf4", "Sox2", "TSPAN12","NM_173007","Q8BKT6",9999,
             "ENSMUSG00000012396","ENSMUSG00000074637")
mapped_genes <- map_genes(genes = genes,
                          species = "mouse", 
                          drop_na = FALSE)
knitr::kable(head(mapped_genes))
```


## Aggregate genes 

`aggregate_mapped_genes` does the following:   

1. Uses `map_genes` to identify *within-species* many-to-one gene mappings (e.g. Ensembl transcript IDs ==> gene symbols). Alternatively, can map *across species* if output from `map_orthologs` is supplied to `gene_map` argument (and `gene_map_col="ortholog_gene"`).   
2. Drops all non-mappable genes.  
3. Aggregates the values of matrix `gene_df` using `"sum"`,`"mean"`,`"median"`,`"min"` or `"max"`. 

Note, this only works when the input data (`gene_df`) is a sparse or dense matrix, and the genes are row names. 

```{r}
data("exp_mouse_enst") 
knitr::kable(tail(as.matrix(exp_mouse_enst)))

exp_agg <- aggregate_mapped_genes(gene_df=exp_mouse_enst,
                                  species="mouse",
                                  FUN = "sum")
knitr::kable(tail(as.matrix(exp_agg)))
```



## Get all genes 

You can also quickly get all known genes from the genome of a given species with [`all_genes`](https://neurogenomics.github.io/orthogene/reference/all_genes.html). 

```{r all_genes}
genome_mouse <- all_genes(species = "mouse", 
                          method = method)

knitr::kable(head(genome_mouse))
```


# Session Info 

<details> 

```{r Session Info}
utils::sessionInfo()
```

</details>  


# Related projects

## Tools 

- [`homologene`](https://github.com/oganm/homologene): `orthogene` uses this package. Provides API access to NCBI [HomoloGene](https://www.ncbi.nlm.nih.gov/homologene) database. 

- [`gprofiler2`](https://cran.r-project.org/web/packages/gprofiler2/vignettes/gprofiler2.html): `orthogene` uses this package. `gprofiler2::gorth()` pulls from [many orthology mapping databases](https://biit.cs.ut.ee/gprofiler/page/organism-list).  

- [`annotationTools`](https://www.bioconductor.org/packages/release/bioc/html/annotationTools.html): For interspecies microarray data.  

- [`orthology`](https://www.leibniz-hki.de/en/orthology-r-package.html): R package for ortholog mapping (deprecated?). 

- [`hpgltools::load_biomart_orthologs()`](https://rdrr.io/github/elsayed-lab/hpgltools/man/load_biomart_orthologs.html): Helper function to get orthologs from biomart. 

- [`JustOrthologs`](https://github.com/ridgelab/JustOrthologs/): Ortholog inference from multi-species genomic sequences. 

- [`orthologr`](https://github.com/drostlab/orthologr): Ortholog inference from multi-species genomic sequences.  

- [`OrthoFinder`](https://github.com/davidemms/OrthoFinder): Gene duplication event inference from multi-species genomics.  


## Databases  

- [HomoloGene](https://www.ncbi.nlm.nih.gov/homologene): NCBI database that the R package [homologene](https://github.com/oganm/homologene) pulls from.   

- [gProfiler](https://biit.cs.ut.ee/gprofiler): Web server for functional enrichment analysis and conversions of gene lists.  

- [OrtholoGene](http://orthologene.org/resources.html): Compiled list of gene orthology resources. 




